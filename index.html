<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" >

<head>
  <base href="" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="robots" content="index, follow" />
  <meta name="keywords" content="" />
  <meta name="rights" content="" />
  <meta name="language" content="sv-SE" />
  <meta name="title" content="Asketorps Bys Samfälligheter" />
  <meta name="author" content="Robert Jernlås" />
  <title>Asketorps Bys Samfälligheter</title>

  <script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>


  <script id="content-page-template" type="text/x-handlebars-template">
    <div class="item-page">
      <h1><strong>{{{title}}}</strong></h1>
      {{{body}}}
    </div>
  </script>

  <script id="menu-template" type="text/x-handlebars-template">
    <div class="moduletable_menu">
      <ul class="menu">
        {{#each pages}}
        <li id="{{menuId}}" class="parent"><a href="#" >{{menuName}}</a>
          <ul>
            {{#each subPages}}
            <li id="{{menuId}}"><a href="#" >{{menuName}}</a></li>
            {{/each}}
          </ul>
        </li>
        {{/each}}
      </ul>
    </div>
  </script>


   <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>



  <div id="allwrap" class="gainlayout" style="width:960px;">
    <div id="headerwrap" class="gainlayout">
      <div id="header" class="gainlayout">
        <div id="logo" class="gainlayout">
          <div id="mainHeader">Asketorp</div>
          <div id="secondaryHeader">Allt av bygemensamt intresse</div>
        </div>
        <div class="clr"></div>
      </div>
      <div class="clr"></div>
    </div>



    <div id="wrap" class="gainlayout">

      <div id="cbody" class="gainlayout">
        <div id="sidebar" style="width:190px;">

        </div>
        <div id="content60" style="width:710px;">

          <div id="content" class="gainlayout">

          </div>
        </div>
        <div class="clr"></div>
      </div>
    </div>

  </div>
  <div id="footerwrap" class="gainlayout" style="width:960px;">
    <div id="footer" class="gainlayout"></div>
  </div>



</body>

<script src="data.js" type="text/javascript"></script>
<script type="text/javascript">





$(function() {

  var $main = $("main"),

  contentTemplate = Handlebars.compile($("#content-page-template").html()),

  menuTemplate = Handlebars.compile($("#menu-template").html()),

  getHashPartOrNull = function(url){
    var hashPos = url.indexOf("#");

    if (hashPos >= 0){
      return url.substr(hashPos + 1);
    }

    return null;
  },

  init = function() {
    console.log("Init");
    $("#sidebar").html(menuTemplate(menu));

    loadPage(getHashPartOrNull(location.href));
  },


  loadPage = function(contentId) {
    // If the contentId is valid, use it, otherwise default to the first id.
    if (! (contentId in data) ){
      contentId = Object.keys(data)[0];
    }
    $("#content").html(contentTemplate(data[contentId]));
  };

  init();

  $(window).on("popstate", function(e) {
    // This can be null if this is the initial page load, that is ok...
    loadPage(e.originalEvent.state);
  });

  $(document).on("click", "a", function() {
    var href = $(this).attr("href"),
    id = $(this).parent().attr("id");


    if (href == "#"){
      console.log("pushing id: " + id);
      history.pushState(id, '', "index.html#"+id);
      loadPage(id);
      return false;
    }
  });
});


</script>
</html>
